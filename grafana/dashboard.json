{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "type": "datasource",
      "pluginId": "prometheus"
    }
  ],
  "title": "vectors.db",
  "uid": "vectorsdb",
  "tags": ["vectorsdb"],
  "timezone": "browser",
  "editable": true,
  "time": { "from": "now-1h", "to": "now" },
  "refresh": "10s",
  "templating": {
    "list": [
      {
        "name": "collection",
        "type": "query",
        "datasource": "${DS_PROMETHEUS}",
        "query": "label_values(vectorsdb_documents_total, collection)",
        "refresh": 2,
        "includeAll": true,
        "multi": true,
        "current": { "text": "All", "value": "$__all" }
      }
    ]
  },
  "panels": [
    {
      "title": "HTTP Request Rate",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 0 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "sum(rate(http_requests_total[1m])) by (status)",
          "legendFormat": "{{status}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": { "fillOpacity": 10 }
        }
      }
    },
    {
      "title": "Request Latency (p50 / p95 / p99)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 0 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(http_request_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p50"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p95"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket[1m])) by (le))",
          "legendFormat": "p99"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "custom": { "fillOpacity": 10 }
        }
      }
    },
    {
      "title": "Error Rate (4xx / 5xx)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 8 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "sum(rate(http_requests_total{status=~\"4..\"}[1m]))",
          "legendFormat": "4xx"
        },
        {
          "expr": "sum(rate(http_requests_total{status=~\"5..\"}[1m]))",
          "legendFormat": "5xx"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": { "fillOpacity": 10 }
        }
      }
    },
    {
      "title": "Search Rate by Type",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 8 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "sum(rate(vectorsdb_search_total{collection=~\"$collection\"}[1m])) by (type)",
          "legendFormat": "{{type}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": { "fillOpacity": 10 }
        }
      }
    },
    {
      "title": "Write Operations Rate",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 16 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "sum(rate(vectorsdb_operations_total{collection=~\"$collection\"}[1m])) by (operation)",
          "legendFormat": "{{operation}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "custom": { "fillOpacity": 10 }
        }
      }
    },
    {
      "title": "Documents per Collection",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 16 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "vectorsdb_documents_total{collection=~\"$collection\"}",
          "legendFormat": "{{collection}}"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "short" }
      }
    },
    {
      "title": "Deleted Documents (soft-deleted)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 24 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "vectorsdb_deleted_total{collection=~\"$collection\"}",
          "legendFormat": "{{collection}}"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "short" }
      }
    },
    {
      "title": "Memory per Collection",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 24 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "vectorsdb_collection_memory_bytes{collection=~\"$collection\"}",
          "legendFormat": "{{collection}}"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "bytes" }
      }
    },
    {
      "title": "WAL Size",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 24 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        {
          "expr": "vectorsdb_wal_size_bytes",
          "legendFormat": "WAL"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "bytes" }
      }
    },
    {
      "title": "Collections Count",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 32 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        { "expr": "vectorsdb_collections_total" }
      ],
      "fieldConfig": {
        "defaults": { "unit": "short" }
      }
    },
    {
      "title": "Total Documents",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 32 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        { "expr": "sum(vectorsdb_documents_total)" }
      ],
      "fieldConfig": {
        "defaults": { "unit": "short" }
      }
    },
    {
      "title": "Total Memory",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 32 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        { "expr": "sum(vectorsdb_collection_memory_bytes)" }
      ],
      "fieldConfig": {
        "defaults": { "unit": "bytes" }
      }
    },
    {
      "title": "Request Rate (total)",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 32 },
      "datasource": "${DS_PROMETHEUS}",
      "targets": [
        { "expr": "sum(rate(http_requests_total[1m]))" }
      ],
      "fieldConfig": {
        "defaults": { "unit": "reqps" }
      }
    }
  ],
  "schemaVersion": 39
}
